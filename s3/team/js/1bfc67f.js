function linksHide(){$("[data-url]").each(function(i,el){var linkUrl=$(el).data("url"),linkText=$(el).html(),linkClass=$(this).attr("class"),linkTarget=$(el).data("target-blank"),linkTitle=$(el).attr("title"),linkStyle=$(el).attr("style"),linkRel=$(el).data("rel"),gaCategory=$(el).data("ga-category"),gaSection=$(el).data("ga-section"),gaId=$(el).data("ga-id");var newNode=$("<a></a>").attr("href",linkUrl).addClass(linkClass).html(linkText);if(typeof linkTarget!=="undefined"&&linkTarget!==false){newNode.attr("target","_blank")}if(typeof linkTitle!=="undefined"&&linkTitle!==false){newNode.attr("title",linkTitle)}if(typeof linkStyle!=="undefined"&&linkStyle!==false){newNode.attr("style",linkStyle)}if(typeof linkRel!=="undefined"&&linkRel!==false){newNode.attr("data",linkRel)}if(typeof gaCategory!=="undefined"&&gaCategory!==false){newNode.attr("data-ga-category",gaCategory)}if(typeof gaSection!=="undefined"&&gaSection!==false){newNode.attr("data-ga-section",gaSection)}if(typeof gaId!=="undefined"&&gaId!==false){newNode.attr("data-ga-id",gaId)}$(el).replaceWith(newNode)})}$(document).ready(function(){linksHide();$("body").on("linksHide",function(){linksHide()})});
function set_cookie(name,value,seconds){if(seconds){var date=new Date;date.setTime(date.getTime()+seconds*1e3);var expires="; expires="+date.toGMTString()}else{var expires=""}document.cookie=name+"="+value+expires+"; path=/"}function get_cookie(cookie_name){var cookie=document.cookie,length=cookie.length;if(length){var cookie_start=cookie.indexOf(cookie_name+"=");if(cookie_start!=-1){var cookie_end=cookie.indexOf(";",cookie_start);if(cookie_end==-1){cookie_end=length}cookie_start+=cookie_name.length+1;return decodeURIComponent(cookie.substring(cookie_start,cookie_end))}}return false}
(function($){$.fn.onScreen=function(options){var params=$.extend({container:window,direction:"vertical",toggleClass:null,doIn:null,doOut:null,tolerance:0,throttle:null,lazyAttr:null,lazyPlaceholder:"data:image/gif;base64,R0lGODlhEAAFAIAAAP///////yH/C05FVFNDQVBFMi4wAwEAAAAh+QQJCQAAACwAAAAAEAAFAAACCIyPqcvtD00BACH5BAkJAAIALAAAAAAQAAUAgfT29Pz6/P///wAAAAIQTGCiywKPmjxUNhjtMlWrAgAh+QQJCQAFACwAAAAAEAAFAIK8urzc2tzEwsS8vrzc3tz///8AAAAAAAADFEiyUf6wCEBHvLPemIHdTzCMDegkACH5BAkJAAYALAAAAAAQAAUAgoSChLS2tIyKjLy+vIyOjMTCxP///wAAAAMUWCQ09jAaAiqQmFosdeXRUAkBCCUAIfkECQkACAAsAAAAABAABQCDvLq83N7c3Nrc9Pb0xMLE/P78vL68/Pr8////AAAAAAAAAAAAAAAAAAAAAAAAAAAABCEwkCnKGbegvQn4RjGMx8F1HxBi5Il4oEiap2DcVYlpZwQAIfkECQkACAAsAAAAABAABQCDvLq85OLkxMLE9Pb0vL685ObkxMbE/Pr8////AAAAAAAAAAAAAAAAAAAAAAAAAAAABCDwnCGHEcIMxPn4VAGMQNBx0zQEZHkiYNiap5RaBKG9EQAh+QQJCQAJACwAAAAAEAAFAIOEgoTMysyMjozs6uyUlpSMiozMzsyUkpTs7uz///8AAAAAAAAAAAAAAAAAAAAAAAAEGTBJiYgoBM09DfhAwHEeKI4dGKLTIHzCwEUAIfkECQkACAAsAAAAABAABQCDvLq85OLkxMLE9Pb0vL685ObkxMbE/Pr8////AAAAAAAAAAAAAAAAAAAAAAAAAAAABCAQSTmMEGaco8+UBSACwWBqHxKOJYd+q1iaXFoRRMbtEQAh+QQJCQAIACwAAAAAEAAFAIO8urzc3tzc2tz09vTEwsT8/vy8vrz8+vz///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAEIhBJWc6wJZAtJh3gcRBAaXiIZV2kiRbgNZbA6VXiUAhGL0QAIfkECQkABgAsAAAAABAABQCChIKEtLa0jIqMvL68jI6MxMLE////AAAAAxRoumxFgoxGCbiANos145e3DJcQJAAh+QQJCQAFACwAAAAAEAAFAIK8urzc2tzEwsS8vrzc3tz///8AAAAAAAADFFi6XCQwtCmAHbPVm9kGWKcEQxkkACH5BAkJAAIALAAAAAAQAAUAgfT29Pz6/P///wAAAAIRlI8SAZsPYnuJMUCRnNksWwAAOw==",debug:false},options);return this.each(function(){var isOnScreen=false;var scrollTop;var scrollLeft;var $el=$(this);var $container;var containerHeight;var containerWidth;var containerBottom;var containerRight;var elHeight;var elWidth;var elTop;var elLeft;var containerIsWindow=$.isWindow(params.container);function verticalIn(){if(containerIsWindow){return elTop<containerBottom-params.tolerance&&scrollTop<elTop+elHeight-params.tolerance}else{return elTop<containerHeight-params.tolerance&&elTop>-elHeight+params.tolerance}}function verticalOut(){if(containerIsWindow){return elTop+(elHeight-params.tolerance)<scrollTop||elTop>containerBottom-params.tolerance}else{return elTop>containerHeight-params.tolerance||-elHeight+params.tolerance>elTop}}function horizontalIn(){if(containerIsWindow){return elLeft<containerRight-params.tolerance&&scrollLeft<elLeft+elWidth-params.tolerance}else{return elLeft<containerWidth-params.tolerance&&elLeft>-elWidth+params.tolerance}}function horizontalOut(){if(containerIsWindow){return elLeft+(elWidth-params.tolerance)<scrollLeft||elLeft>containerRight-params.tolerance}else{return elLeft>containerWidth-params.tolerance||-elWidth+params.tolerance>elLeft}}function directionIn(){if(isOnScreen){return false}if(params.direction==="horizontal"){return horizontalIn()}else{return verticalIn()}}function directionOut(){if(!isOnScreen){return false}if(params.direction==="horizontal"){return horizontalOut()}else{return verticalOut()}}function throttle(fn,timeout,ctx){var timer,args,needInvoke;return function(){args=arguments;needInvoke=true;ctx=ctx||this;if(!timer){(function(){if(needInvoke){fn.apply(ctx,args);needInvoke=false;timer=setTimeout(arguments.callee,timeout)}else{timer=null}})()}}}var checkPos=function(){if(!containerIsWindow&&$(params.container).css("position")==="static"){$(params.container).css("position","relative")}$container=$(params.container);containerHeight=$container.height();containerWidth=$container.width();containerBottom=$container.scrollTop()+containerHeight;containerRight=$container.scrollLeft()+containerWidth;elHeight=$el.outerHeight(true);elWidth=$el.outerWidth(true);if(containerIsWindow){var offset=$el.offset();elTop=offset.top;elLeft=offset.left}else{var position=$el.position();elTop=position.top;elLeft=position.left}scrollTop=$container.scrollTop();scrollLeft=$container.scrollLeft();if(params.debug){console.log("Container: "+params.container+"\n"+"Width: "+containerHeight+"\n"+"Height: "+containerWidth+"\n"+"Bottom: "+containerBottom+"\n"+"Right: "+containerRight);console.log("Matched element: "+($el.attr("class")!==undefined?$el.prop("tagName").toLowerCase()+"."+$el.attr("class"):$el.prop("tagName").toLowerCase())+"\n"+"Left: "+elLeft+"\n"+"Top: "+elTop+"\n"+"Width: "+elWidth+"\n"+"Height: "+elHeight)}if(directionIn()){if(params.toggleClass){$el.addClass(params.toggleClass)}if($.isFunction(params.doIn)){params.doIn.call($el[0])}if(params.lazyAttr&&$el.prop("tagName")==="IMG"){var lazyImg=$el.attr(params.lazyAttr);if(lazyImg!==$el.prop("src")){$el.css({background:"url("+params.lazyPlaceholder+") 50% 50% no-repeat",minHeight:"5px",minWidth:"16px"});$el.prop("src",lazyImg).load(function(){$(this).css({background:"none"})})}}isOnScreen=true}else if(directionOut()){if(params.toggleClass){$el.removeClass(params.toggleClass)}if($.isFunction(params.doOut)){params.doOut.call($el[0])}isOnScreen=false}};if(window.location.hash){throttle(checkPos,50)}else{checkPos()}if(params.throttle){checkPos=throttle(checkPos,params.throttle)}$(params.container).on("scroll resize",checkPos);if(!containerIsWindow){$(window).on("resize",checkPos)}if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=jQuery}else{if(typeof define==="function"&&define.amd){define("jquery-onscreen",[],function(){return jQuery})}}})}})(jQuery);
function stat(type,id){var fromHomepage=getParameterByName("ft");$.post("/stat",{type:type,id:parseInt(id,10),ft:fromHomepage?1:0},function(){},"json")}function rotation_stat(){var ids=[];$(".r-stat").each(function(i,el){var id=$(el).data("rstat-id");if(id!=undefined){ids.push(id)}});$.post("/rstat",{sets:ids})}function rotationStatMain(){thumbStatList={prevRecordedCount:0,list:[],recordedList:[]};$(".r-stat",".thumbs").onScreen({container:window,direction:"vertical",doIn:function(){var id=$(this).data("rstat-id");if($.inArray(id,thumbStatList.list)==-1){thumbStatList.list.push(id)}},throttle:50,toggleClass:"onScreen"});setInterval(function(){if(thumbStatList.prevRecordedCount!=thumbStatList.list.length){thumbStatList.prevRecordedCount=thumbStatList.list.length;var list=[];$.each(thumbStatList.list,function(i,e){if($.inArray(e,thumbStatList.recordedList)==-1)list.push(e)});$.post("/rstat",{sets:list});thumbStatList.recordedList.push.apply(thumbStatList.recordedList,list)}},800)}
$.fn.insertAtCaret=function(tagName){return this.each(function(){if(document.selection){this.focus();sel=document.selection.createRange();sel.text=tagName;this.focus()}else if(this.selectionStart||this.selectionStart=="0"){startPos=this.selectionStart;endPos=this.selectionEnd;scrollTop=this.scrollTop;this.value=this.value.substring(0,startPos)+tagName+this.value.substring(endPos,this.value.length);this.focus();this.selectionStart=startPos+tagName.length;this.selectionEnd=startPos+tagName.length;this.scrollTop=scrollTop}else{this.value+=tagName;this.focus()}})};$.fn.insertRoundCaret=function(tagName){return this.each(function(){strStart="["+tagName+"]";strEnd="[/"+tagName+"]";if(document.selection){stringBefore=this.value;this.focus();sel=document.selection.createRange();insertstring=sel.text;fullinsertstring=strStart+sel.text+strEnd;sel.text=fullinsertstring;document.selection.empty();this.focus();stringAfter=this.value;i=stringAfter.lastIndexOf(fullinsertstring);range=this.createTextRange();numlines=stringBefore.substring(0,i).split("\n").length;i=i+3-numlines+tagName.length;j=insertstring.length;range.move("character",i);range.moveEnd("character",j);range.select()}else if(this.selectionStart||this.selectionStart=="0"){startPos=this.selectionStart;endPos=this.selectionEnd;scrollTop=this.scrollTop;this.value=this.value.substring(0,startPos)+strStart+this.value.substring(startPos,endPos)+strEnd+this.value.substring(endPos,this.value.length);this.focus();this.selectionStart=startPos+strStart.length;this.selectionEnd=endPos+strStart.length;this.scrollTop=scrollTop}else{this.value+=strStart+strEnd;this.focus()}})};